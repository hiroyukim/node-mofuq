#!/usr/bin/env node
'use strict';

var yaml    = require('js-yaml'),
    fs      = require('fs'),
    sprintf = require('sprintf').sprintf,
    program = require('commander'),
    log4js  = require('log4js'),
    logger  = log4js.getLogger();

program
    .usage('<filepath>')
    .parse(process.argv);

var filepath = program.args[0];

if(!filepath) {
    program.help();
}

try {
    var data = yaml.safeLoad(fs.readFileSync(filepath, 'utf8'));
} catch(e) {
    logger.error(e);
    program.help();
}

function create_progress_bar(progress) {
    progress = progress / 10;
    var array = [];
    for( var i=0; i < 10; i++ ) {
        array.push(
            ( i < progress ) ? '#' : '_'
        );
    }
    return '[' + array.join('') + ']';
}

var sum_hour = 0;
for( var i in data ) {
    console.log(
        create_progress_bar(data[i].progress),
        sprintf("(%03d%%)",data[i].progress),
        sprintf("[%02dh]",data[i]['hour'] || 0),
        data[i].name
    );
    sum_hour += data[i]['hour'] || 0;
}

console.log("total(hour): " + sum_hour );
